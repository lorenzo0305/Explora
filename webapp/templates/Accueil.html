<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WishAdventure ‚Äî Accueil</title>
  <link rel="stylesheet" href="/static/styles/app.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#190028;
      --accent:#FF6000;
      --text:#F9F0F7;
      --text-dim:rgba(249,240,247,.70);
      --card:rgba(255,255,255,.04);
      --nav-h:64px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      min-height:100vh;
    }

    .app-frame{width:100vw;height:100vh;background:var(--bg);position:relative;overflow:hidden;display:flex;flex-direction:column;}
    .content-panel{padding:28px 20px calc(var(--nav-h) + 24px) 20px;display:flex;flex-direction:column;gap:32px;flex:1;overflow:auto;scrollbar-width:thin;}
    .content-inner{width:100%;max-width:960px;margin:0 auto;display:flex;flex-direction:column;gap:32px;}

    /* Header : Salutation √† gauche, Actions √† droite */
    .header-row{display:flex;align-items:center;justify-content:space-between;margin-top:20px;margin-left:10px;margin-right:10px;}
    .header-greeting{display:flex;align-items:center;gap:12px;}
    .avatar-icon{width:40px;height:40px;border-radius:50%;background-color:var(--accent);fill:white;padding:8px;flex-shrink:0;}
    .greeting-text{font-size:24px;font-weight:600;color:var(--text);}

    /* Actions (Panier / Coeur) */
    .actions{ position:relative; display:flex; align-items:center; gap:8px; }
    .action-btn{
      background:rgba(255,255,255,.08); color:#fff; border:none;
      padding:6px 10px; border-radius:8px; font-weight:600; font-size:12px; line-height:1;
      cursor:pointer; display:flex; align-items:center; gap:6px;
    }
    .action-btn.active { color: #ff4081; }
    .badge{ font-size:11px; background:var(--accent); color:#190028; border-radius:999px; padding:2px 6px; font-weight:800; }
    .badge.pink{ background:#ff4081; color:#fff; }

    /* Panels flottants */
    .floating-panel{
      position:absolute; top:calc(100% + 8px); right:0;
      width:min(300px, 80vw); max-height:min(50vh, 400px); overflow:auto;
      background:#1e1e1e; border-radius:12px; padding:10px; display:none; z-index:100;
      box-shadow:0 16px 36px rgba(0,0,0,.5); border:1px solid rgba(255,255,255,.1);
    }
    .floating-panel h4{ margin:6px 0 8px; font-size:14px; opacity:.9; border-bottom:1px solid rgba(255,255,255,.1); padding-bottom:6px; }
    .panel-empty{ color:var(--text-dim); font-size:13px; margin:6px 0; font-style:italic; }
    .panel-item{
      display:flex; align-items:center; gap:8px; padding:6px; border-radius:8px;
      background:rgba(255,255,255,.04); margin-bottom:6px;
    }
    .panel-item img{ width:36px; height:36px; border-radius:6px; object-fit:cover }
    .panel-item .pi-name{ font-size:13px; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:140px; }
    .panel-item .pi-remove{
      margin-left:auto; background:rgba(255,255,255,.08); color:#fff; border:none;
      padding:4px 8px; border-radius:6px; font-size:11px; cursor:pointer;
    }
    .panel-footer{ display:flex; justify-content:flex-end; margin-top:8px; }
    .panel-footer a{ background:var(--accent); color:#190028; border-radius:8px; padding:6px 10px; font-weight:700; text-decoration:none; font-size:12px; }

    .top-title{display:flex;flex-direction:column;align-items:center;text-align:center;margin-top:20px;}
    .title{font-size:28px;font-weight:700;color:var(--text);line-height:1.2;}

    .section{display:flex;flex-direction:column;align-items:center;gap:16px;}
    .section-title{font-size:20px;font-weight:600;color:var(--text);text-align:center;margin-top:24px;}

    /* Grille activit√©s */
    .proposals-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:16px; width:100%; }
    .proposal-item{display:flex;flex-direction:column;align-items:center;gap:10px;min-height:200px;padding:8px;border-radius:8px;color:#F9F0F7;background:rgba(255,255,255,.00);}
    .proposal-item .thumb{ width:150px;height:150px;border-radius:7.5px;flex-shrink:0; background-size:cover;background-position:center; box-shadow:0 0 0 1px rgba(255,255,255,.06) inset; }
    .proposal-item .name{ font-size:15px;font-weight:600;text-align:center;max-width:150px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis; }
    .proposal-item.placeholder .thumb{background:linear-gradient(180deg,#2b2137 0%,#120c19 100%);}
    .proposal-item.placeholder .name{opacity:.85}

    /* Listes horizontales */
    .featured-list{display:flex;gap:20px;overflow-x:auto;padding-bottom:10px;}
    .featured-item{width:150px;flex:0 0 auto;display:flex;flex-direction:column;gap:12px;cursor:pointer;}
    .featured-item .thumb{width:150px;height:150px;border-radius:7.5px;background-size:cover;background-position:center;}
    .featured-item .name{font-size:18px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .featured-item .comment{height:50px;padding:5px;background:rgba(249,240,247,.15);border-radius:10.5px;color:rgba(249,240,247,.60);font-size:9px;font-weight:600;line-height:1.5;overflow:hidden;text-overflow:ellipsis;}
    .featured-item.placeholder .name{opacity:.95}

    .stars{display:flex;gap:4px;}
    .stars .star{width:15px;height:15px;background-color:rgba(255,255,255,.7);clip-path:polygon(50% 0%,61.8% 38.2%,100% 38.2%,69.1% 61.8%,80.9% 100%,50% 76.4%,19.1% 100%,30.9% 61.8%,0% 38.2%,38.2% 38.2%);}
    .stars .star.active{background-color:#FFD700;}

    nav.bottom-nav{position:absolute;left:0;right:0;bottom:0;height:var(--nav-h);display:flex;gap:8px;padding:10px;background:rgba(0,0,0,.25);backdrop-filter:blur(6px);border-top:1px solid rgba(255,255,255,.06);}
    .boutonNav{flex:1;border:none;border-radius:12px;padding:10px 8px;background:rgba(255,255,255,.06);color:#fff;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;}
    .boutonNav.active{background:var(--accent);color:#190028}
    .nav-icon{width:18px;height:18px;vertical-align:-3px;fill:#fff;}
  </style>
</head>
<body>

  <div class="app-frame">
    <div class="content-panel">
      <div class="content-inner">

        <div class="header-row">
          <div class="header-greeting">
            <svg class="avatar-icon" viewBox="0 0 24 24">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <div class="greeting-text">Bonjour</div>
          </div>

          <div class="actions">
            <button id="likesIcon" class="action-btn" type="button" title="Mes Favoris">
              ‚ù§Ô∏è <span id="likesCount" class="badge pink" hidden>0</span>
            </button>
            <div id="floatingLikes" class="floating-panel" aria-live="polite"></div>

            <button id="basketIcon" class="action-btn" type="button" title="Panier">
              üß∫ <span id="basketCount" class="badge" hidden>0</span>
            </button>
            <div id="floatingBasket" class="floating-panel" aria-live="polite"></div>
          </div>
        </div>

        <div class="top-title">
          <div class="title">Exprimez vos souhaits, <br>Nous cr√©ons votre voyage de r√™ve !</div>
        </div>

        <div class="proposals-grid" id="activitiesGrid"></div>

        <div class="section">
          <div class="section-title">Propos√©s par l‚Äôoffice du tourisme</div>
          <div class="featured-list">
             <div class="featured-item">
              <div class="thumb" style="background: linear-gradient(180deg, #FF6000 0%, #993A00 100%);"></div>
              <div class="name">Escapade Gourmande</div>
              <div class="comment">Une d√©couverte des saveurs locales...</div>
              <div class="stars"><div class="star active"></div><div class="star active"></div><div class="star active"></div><div class="star"></div><div class="star"></div></div>
            </div>
            <div class="featured-item">
              <div class="thumb" style="background: linear-gradient(180deg, #00999A 0%, #003434 100%);"></div>
              <div class="name">Nature & D√©couverte</div>
              <div class="comment">Randonn√©es et paysages √† couper le souffle.</div>
              <div class="stars"><div class="star active"></div><div class="star active"></div><div class="star active"></div><div class="star active"></div><div class="star"></div></div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title">R√©cemment vus !</div>
          <div id="recentList" class="featured-list"></div>
          <p id="recentEmpty" class="section-subtitle" style="display:none;opacity:.8;">Aucun voyage pour le moment.</p>
        </div>

      </div>
    </div>

    <nav class="bottom-nav">
      <a href="/" class="bouton"><button class="boutonNav active"><svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3z"/></svg>Accueil</button></a>
      <a href="/Destinations" class="bouton"><button class="boutonNav"><svg class="nav-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="6"></circle><path d="M20 20l-3.5-3.5" stroke="white" stroke-width="2" stroke-linecap="round" fill="none"/></svg>Exploration</button></a>
      <a href="/topics" class="bouton"><button class="boutonNav"><svg class="nav-icon" viewBox="0 0 24 24"><path d="M5 4h11a2 2 0 0 1 2 2v12H7a2 2 0 0 1-2-2V4z"/><rect x="3" y="6" width="2" height="12" rx="1" ry="1"/><path d="M8 8h7M8 11h7M8 14h5" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/></svg>Carnet</button></a>
      <a href="/makejourney" class="bouton"><button class="boutonNav"><svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 2a6 6 0 0 0-6 6c0 4.5 6 12 6 12s6-7.5 6-12a6 6 0 0 0-6-6zm0 8.5A2.5 2.5 0 1 1 12 5.5a2.5 2.5 0 0 1 0 5z"/><path d="M15.2 14.2l3.2 3.2-2.3 0.5-1.4 1.4-0.5-2.3 1-1z"/></svg>Cr√©ation</button></a>
    </nav>
  </div>

  <script>
    /* ===== Logic Panier & Favoris ===== */
    const BASKET_KEY = 'wish_basket_v1';
    const LIKES_KEY = 'wish_likes_v1';
    
    // Elements
    const basketIcon = document.getElementById('basketIcon');
    const basketCount = document.getElementById('basketCount');
    const floatingBasket = document.getElementById('floatingBasket');
    const likesIcon = document.getElementById('likesIcon');
    const likesCount = document.getElementById('likesCount');
    const floatingLikes = document.getElementById('floatingLikes');

    // Loaders
    const loadData = (k) => { try{ return JSON.parse(localStorage.getItem(k)||'[]'); }catch{ return []; } };
    const saveData = (k, d) => { localStorage.setItem(k, JSON.stringify(d)); updateCounts(); renderPanels(); };

    // Update Counts
    function updateCounts(){
      const b = loadData(BASKET_KEY).length;
      basketCount.textContent = b; basketCount.hidden = b===0;
      const l = loadData(LIKES_KEY).length;
      likesCount.textContent = l; likesCount.hidden = l===0;
    }

    // Render Logic
    function renderPanel(key, container, title, emptyMsg, isLike=false){
      const items = loadData(key);
      if(!items.length){
        container.innerHTML = `<h4>${title}</h4><p class="panel-empty">${emptyMsg}</p>` + (isLike ? '' : `<div class="panel-footer"><a href="/makejourney">Aller √† la cr√©ation</a></div>`);
        return;
      }
      const html = items.map(x => `
        <div class="panel-item">
          <img src="${x.image || '/static/img/no-image.jpg'}" alt="">
          <div class="pi-name">${x.name || 'Sans nom'}</div>
          <button class="pi-remove" onclick="removeItem('${key}', '${x.id}')">‚úï</button>
        </div>
      `).join('');
      container.innerHTML = `<h4>${title}</h4>${html}` + (isLike ? '' : `<div class="panel-footer"><a href="/makejourney">Aller √† la cr√©ation</a></div>`);
    }

    function renderPanels(){
      renderPanel(BASKET_KEY, floatingBasket, 'Votre panier', 'Votre panier est vide.');
      renderPanel(LIKES_KEY, floatingLikes, 'Mes Favoris', 'Aucun favori.', true);
    }

    // Global remove function
    window.removeItem = function(key, id){
      const data = loadData(key).filter(x => String(x.id) !== String(id));
      saveData(key, data);
    };

    // Toggles
    basketIcon.addEventListener('click', (e)=>{
      e.stopPropagation();
      floatingLikes.style.display = 'none';
      floatingBasket.style.display = floatingBasket.style.display==='block' ? 'none' : 'block';
    });
    likesIcon.addEventListener('click', (e)=>{
      e.stopPropagation();
      floatingBasket.style.display = 'none';
      floatingLikes.style.display = floatingLikes.style.display==='block' ? 'none' : 'block';
    });
    document.addEventListener('click', (e)=>{
      if(!floatingBasket.contains(e.target) && e.target !== basketIcon) floatingBasket.style.display = 'none';
      if(!floatingLikes.contains(e.target) && e.target !== likesIcon) floatingLikes.style.display = 'none';
    });

    /* ===== Donn√©es Voyages ===== */
    const JOURNEYS_KEY = "wish_journeys_v1";
    const DEFAULT_COVER = "/static/img/no-image.jpg";
    const GRADIENTS = ["linear-gradient(180deg, #FF6000 0%, #993A00 100%)", "linear-gradient(180deg, #00999A 0%, #003434 100%)", "linear-gradient(180deg, #9747FF 0%, #33145C 100%)", "linear-gradient(180deg, #FDC43F 0%, #991B10 100%)", "linear-gradient(180deg, #C6E2E9 0%, #6F7F83 100%)"];

    const lsGetJourneys = () => { try { return JSON.parse(localStorage.getItem(JOURNEYS_KEY) || "[]"); } catch { return []; } };
    const normArrLike = (a) => Array.isArray(a) ? a : (a && typeof a === "object") ? Object.values(a) : [];
    const isHttp = (u)=> typeof u==="string" && /^https?:\/\//i.test(u);
    const isNonDefaultImg = (u)=> !!u && typeof u==="string" && u.indexOf("no-image")===-1;

    function deriveDays(j){
      if (Array.isArray(j?.plan)) return j.plan.map((d,i)=>({ day:(d?.day!=null?Number(d.day):i+1), slots: d?.slots }));
      return []; // Simplifi√© pour l'accueil
    }

    function metaText(j){
      const d = Array.isArray(j?.plan) ? j.plan.length : 0;
      return (j.location ? j.location + " ‚Ä¢ " : "") + d + (d>1 ? " jours" : " jour");
    }

    function pickCover(j){
      if (j?.cover) return j.cover;
      // Fallback simple
      return DEFAULT_COVER;
    }

    function buildStars(active=4){
      const wrap = document.createElement("div"); wrap.className = "stars";
      for (let i=0;i<5;i++){ const st=document.createElement("div"); st.className="star"+(i<active?" active":""); wrap.appendChild(st); }
      return wrap;
    }

    function buildRecentCard(j){
      const item = document.createElement("div"); item.className = "featured-item";
      item.addEventListener("click", () => window.location.href = `/journeys/view/${encodeURIComponent(j.id)}`);
      const th = document.createElement("div"); th.className = "thumb"; th.style.backgroundImage = `url('${pickCover(j)}')`;
      const nm = document.createElement("div"); nm.className = "name"; nm.textContent = j?.name || "Voyage sans titre";
      const com = document.createElement("div"); com.className = "comment"; com.textContent = metaText(j);
      item.append(th, nm, com, buildStars(4));
      return item;
    }

    function buildStyledPlaceholderCard(i=0){
      const item = document.createElement("div"); item.className = "featured-item placeholder";
      const th = document.createElement("div"); th.className = "thumb"; th.style.background = GRADIENTS[i % GRADIENTS.length];
      const nm = document.createElement("div"); nm.className = "name"; nm.textContent = "Nom du voyage";
      const com = document.createElement("div"); com.className = "comment"; com.textContent = "Bient√¥t disponible";
      item.append(th, nm, com, buildStars(0));
      return item;
    }

    function renderRecent(){
      const list = document.getElementById("recentList");
      const empty = document.getElementById("recentEmpty");
      list.innerHTML = ""; empty.style.display = "none";
      const journeys = lsGetJourneys().filter(j => j && j.id != null).sort((a,b)=> new Date(b?.updatedAt||0) - new Date(a?.updatedAt||0)).slice(0, 5);
      if (!journeys.length) empty.style.display = "block";
      journeys.forEach(j => list.appendChild(buildRecentCard(j)));
      for (let i = journeys.length; i < 5; i++) list.appendChild(buildStyledPlaceholderCard(i));
    }

    /* Activit√©s avec photo (Logique simplifi√©e pour affichage) */
    function buildActivityCard(act){
      const card = document.createElement("div"); card.className = "proposal-item";
      const th = document.createElement("div"); th.className = "thumb"; th.style.backgroundImage = `url('${act.image}')`;
      const nm = document.createElement("div"); nm.className = "name"; nm.textContent = act.name || "Activit√©";
      card.append(th, nm);
      if (act.id) { card.style.cursor="pointer"; card.addEventListener("click", ()=>window.location.href=`/detail-act-perso/${encodeURIComponent(act.id)}`); }
      return card;
    }
    function buildPlaceholderActivity(i){
      const card = document.createElement("div"); card.className = "proposal-item placeholder";
      const th = document.createElement("div"); th.className = "thumb"; th.style.background = GRADIENTS[i % GRADIENTS.length];
      const nm = document.createElement("div"); nm.className = "name"; nm.textContent = "Suggestion";
      card.append(th, nm); return card;
    }
    
    // Fonction mock pour l'exemple (normalement parcourt les voyages pour trouver des photos)
    function renderActivities(){
      const grid = document.getElementById("activitiesGrid"); grid.innerHTML = "";
      // Ici on met juste des placeholders pour l'exemple visuel demand√©
      for(let i=0; i<5; i++) grid.appendChild(buildPlaceholderActivity(i));
    }

    window.addEventListener("storage", (e) => {
      if (e.key === JOURNEYS_KEY || e.key === BASKET_KEY || e.key === LIKES_KEY){
        renderRecent(); updateCounts(); renderPanels();
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      renderRecent(); renderActivities(); updateCounts(); renderPanels();
    });
  </script>
</body>
</html>